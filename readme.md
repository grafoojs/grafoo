<h1 align=center>
  <svg width="376" height="136" style="margin: 80px 0">
    <title>Grafoo</title>
    <path
      d="M136.929 76.002H123.56l-3.478 7.587h-5.077l15.452-33.198 14.906 33.198h-5.157l-3.277-7.587zm-1.921-4.43l-4.632-10.621-4.854 10.62h9.486zM30.52 67.323H17.616v4.43h7.787c-.216 2.2-1.247 4.087-3.095 5.665-1.847 1.565-3.93 2.347-6.25 2.347-2.723 0-5.251-1.045-7.584-3.136-2.494-2.252-3.741-5.118-3.741-8.598 0-3.371 1.119-6.177 3.357-8.415 2.238-2.28 5.01-3.42 8.313-3.42 3.68 0 6.802 1.707 9.364 5.119l3.357-3.217c-1.955-2.238-3.944-3.857-5.966-4.855-2.117-.998-4.396-1.497-6.836-1.497-4.544 0-8.4 1.585-11.57 4.754C1.585 59.656 0 63.5 0 68.031c0 4.438 1.557 8.241 4.672 11.41 3.115 3.156 6.856 4.734 11.225 4.734 4.476 0 8.164-1.632 11.063-4.895 1.281-1.457 2.191-3.021 2.73-4.694.553-1.807.83-3.884.83-6.23v-1.032zM85.292 83.589l-9.668-13.312c2.077-.445 3.749-1.463 5.016-3.055 1.268-1.591 1.901-3.493 1.901-5.705 0-2.832-1.01-5.111-3.034-6.838-1.833-1.55-4.813-2.326-8.939-2.326h-5.521v31.236h4.712V70.803h.85l8.919 12.786h5.764zM71.256 66.696h-1.497v-9.913h1.679c4.341 0 6.512 1.599 6.512 4.795 0 3.412-2.231 5.118-6.694 5.118zM182.58 56.783h10.881v-4.43h-15.594v31.236h4.713v-14.87h10.497v-4.43H182.58v-7.506z"
      fill="currentColor" />
    <path
      d="M359.547 23.643a22.491 22.491 0 01-3.086 3.725C365.683 38.357 371.237 52.53 371.237 68c0 15.417-5.516 29.545-14.681 40.518a22.52 22.52 0 013.068 3.749C369.832 100.372 376 84.907 376 68c0-16.949-6.199-32.45-16.453-44.357zM320.477 134.861a22.508 22.508 0 01-1.716-4.535 63.598 63.598 0 01-10.743.909c-27.315 0-50.584-17.327-59.419-41.593-1.544.444-3.14.726-4.763.831 9.278 26.512 34.51 45.527 64.182 45.527 4.256 0 8.42-.391 12.459-1.139zM243.907 45.324C253.242 18.918 278.421 0 308.018 0c4.222 0 8.355.385 12.364 1.122a22.48 22.48 0 00-1.671 4.543 63.619 63.619 0 00-10.693-.9c-27.244 0-50.464 17.238-59.351 41.405a22.519 22.519 0 00-4.76-.846z"
      fill="#BB6BD9" />
    <path
      d="M252.608 67.896c0-7.808-8.469-12.72-15.265-8.797-6.778 3.911-6.778 13.683 0 17.594 6.796 3.922 15.265-.99 15.265-8.797zM335.538 133.36c6.796 3.922 15.264-.99 15.264-8.797 0-7.808-8.468-12.72-15.264-8.798-6.778 3.912-6.778 13.683 0 17.595zM335.538 2.432c-6.778 3.912-6.778 13.683 0 17.595 6.796 3.922 15.264-.99 15.264-8.798 0-7.807-8.468-12.719-15.264-8.797zM296.433 56.5c-3.222 3.156-4.833 6.932-4.833 11.329 0 5.003 1.766 9.05 5.299 12.138 3.209 2.792 6.829 4.188 10.861 4.188 4.557 0 8.447-1.572 11.669-4.714 3.21-3.13 4.814-6.94 4.814-11.43 0-4.464-1.598-8.288-4.793-11.471-3.182-3.183-6.998-4.774-11.448-4.774-4.503 0-8.36 1.578-11.569 4.733z"
      fill="currentColor" />
  </svg>
</h1>

<p align=center><i>A GraphQL Client and Toolkit</i></p>

<p align=center>
  <a href=https://circleci.com/gh/grafoojs/grafoo>
    <img
      src=https://img.shields.io/circleci/project/github/grafoojs/grafoo/master.svg?label=build
      alt=build
    />
  </a>
  <a href=https://codecov.io/github/grafoojs/grafoo>
    <img
      src=https://img.shields.io/codecov/c/github/grafoojs/grafoo/master.svg
      alt="coverage"
    />
  </a>
  <a href=https://github.com/grafoojs/grafoo>
    <img
      src=https://img.shields.io/npm/v/@grafoo/babel-plugin.svg
      alt=npm
    >
  </a>
  <a href=https://github.com/grafoojs/grafoo>
    <img
      src=https://img.shields.io/npm/dm/@grafoo/babel-plugin.svg
      alt=downloads
    >
  </a>
  <a href=https://prettier.io>
    <img
      src=https://img.shields.io/badge/code_style-prettier-ff69b4.svg
      alt="code style: prettier"
    />
  </a>
  <a href=https://lernajs.io>
    <img
      src=https://img.shields.io/badge/maintained%20with-lerna-cc00ff.svg
      alt="mantained with: lerna"
    />
  </a>
  <a href=https://grafoo-slack.herokuapp.com>
    <img
      src=https://grafoo-slack.herokuapp.com/badge.svg
      alt="slack"
    />
  </a>
</p>

Grafoo is a GraphQL client that tries to be different by adopting a **simpler API**, without giving up of a **good caching strategy**.

## Some useful information

- **It's a multiple paradigm library**. So far we have **view layer integrations** for [react](https://github.com/grafoojs/grafoo/tree/master/packages/react) and [preact](https://github.com/grafoojs/grafoo/tree/master/packages/preact) and there are more to come.
- **It's not just a HTTP client**. It comes with a sophisticated caching system under the hood to make sure your data is consistent across your app.
- **It's build time dependent**. A important piece of Grafoo is it's **babel** plugin that compiles your queries based on the schema your app consumes.
- **It's environment agnostic**. Apart from the browser you can run Grafoo on the **server** and even on **native** with react.

## Why should I use this

Many of the work that has been put into this project came from borrowed ideas and concepts that are present in the GraphQL clients we have today. Grafoo wants to stand apart from the others trying to be in that sweet spot between **simplicity** and **usability**. Moreover, most of the benefits this library brings to the table are related to the fact that it does a lot at build time. It's **fast**, because it spares runtime computation and it's really **small** (something like **~1.6kb** for core and react) because it does not ship with a GraphQL parser.

## Example applications

You can refer to examples in [this repository](https://github.com/grafoojs/grafoo-examples).

## Basic usage

### Installation

The basic packages you'll have to install in order to use Grafoo are core and babel-plugin.

```
$ npm i @grafoo/core && npm i -D @grafoo/babel-plugin
```

### Configure babel

In `@grafoo/babel-plugin` the option `schema` is a path to a GraphQL schema in your file system relative to the root of your project and `idFields` is an array of strings that represent the fields that Grafoo will automatically insert on your queries to build unique identifiers in order to normalize the cache. **Both options are required**.

```json
{
  "plugins": [
    [
      "@grafoo/babel-plugin",
      {
        "schema": "schema.graphql",
        "idFields": ["id"]
      }
    ]
  ]
}
```

### Writing your app

From `@grafoo/core` you will import the factory that creates the client instance and from submodule `@grafoo/core/tag` you'll import the `graphql` or `gql` tag that will be compiled at build time.

```js
import createClient from "@grafoo/core";
import gql from "@grafoo/core/tag";

function fetchQuery(query, variables) {
  const init = {
    method: "POST",
    body: JSON.stringify({ query, variables }),
    headers: {
      "content-type": "application/json",
    },
  };

  return fetch("http://some.graphql.api", init).then((res) => res.json());
}

const client = createClient(fetchQuery);

const USER_QUERY = gql`
  query($id: ID!) {
    user(id: $id) {
      name
    }
  }
`;

const variables = { id: 123 };

client.execute(USER_QUERY, variables).then((data) => {
  // Write to cache
  client.write(USER_QUERY, variables, data);

  // Do whatever with returned data
  console.log(data);

  // Read from cache at a later stage
  console.log(client.read(USER_QUERY, variables));
});

// If you wish to reset (clear) the cache:
client.reset();
```

### With a framework

Here is how it would go for you to write a simple react app.

#### `index.js`

```jsx
import React from "react";
import ReactDom from "react-dom";
import createClient from "@grafoo/core";
import { Provider } from "@grafoo/react";

import Posts from "./Posts";

function fetchQuery(query, variables) {
  const init = {
    method: "POST",
    body: JSON.stringify({ query, variables }),
    headers: {
      "content-type": "application/json",
    },
  };

  return fetch("http://some.graphql.api", init).then((res) => res.json());
}

const client = createClient(fetchQuery);

ReactDom.render(
  <Provider client={client}>
    <Posts />
  </Provider>,
  document.getElementById("mnt")
);
```

#### `Posts.js`

```jsx
import React from "react";
import gql from "@grafoo/core/tag";
import { Consumer } from "@grafoo/react";

const ALL_POSTS = gql`
  query getPosts($orderBy: PostOrderBy) {
    allPosts(orderBy: $orderBy) {
      title
      content
      createdAt
      updatedAt
    }
  }
`;

export default function Posts() {
  return (
    <Consumer query={ALL_POSTS} variables={{ orderBy: "createdAt_DESC" }}>
      {({ client, load, loaded, loading, errors, allPosts }) => (
        <marquee>ðŸ‘† do whatever you want with the variables above ðŸ‘†</marquee>
      )}
    </Consumer>
  );
}
```

### Mutations

```jsx
import React from "react";
import gql from "@grafoo/core/tag";
import { Consumer } from "@grafoo/react";

const ALL_POSTS = gql`
  query getPosts($orderBy: PostOrderBy) {
    allPosts(orderBy: $orderBy) {
      title
      content
      createdAt
      updatedAt
    }
  }
`;

const CREATE_POST = gql`
  mutation createPost($content: String, $title: String, $authorId: ID) {
    createPost(content: $content, title: $title, authorId: $authorId) {
      title
      content
      createdAt
      updatedAt
    }
  }
`;

const mutations = {
  createPost: {
    query: CREATE_POST,
    optimisticUpdate: ({ allPosts }, variables) => ({
      allPosts: [{ ...variables, id: "tempID" }, ...allPosts],
    }),
    update: ({ allPosts }, data) => ({
      allPosts: allPosts.map((p) => (p.id === "tempID" ? data.createPost : p)),
    }),
  },
};

const submit = (mutate) => (event) => {
  event.preventDefault();

  const { title, content } = event.target.elements;

  mutate({ title: title.value, content: content.value });
};

export default function PostForm() {
  return (
    <Consumer query={ALL_POSTS} variables={{ orderBy: "createdAt_DESC" }} mutations={mutations}>
      {({ createPost }) => (
        <form onSubmit={submit(createPost)}>
          <input name="title" />
          <textarea name="content" />
          <button>submit</button>
        </form>
      )}
    </Consumer>
  );
}
```

## LICENSE

[MIT](https://github.com/grafoojs/grafoo/blob/master/LICENSE)
